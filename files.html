<!-- 
 *  Copyright (c) Akshay Thakare. All rights reserved.
 *  Licensed under the MIT License. See license.txt in the project root for license information.
 -->

<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
    	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    	<meta http-equiv="x-ua-compatible" content="ie=edge">

		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

		<!-- Latest compiled and minified jQuery -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

		<!-- Socket IO lib -->
		<script src="/socket.io/socket.io.js"></script>
	</head>
	<body style="padding-top: 70px;">

		<nav class="navbar navbar-default navbar-fixed-top">
  			<div class="container-fluid">
			    
			    <!-- Brand and toggle get grouped for better mobile display -->
			    <div class="navbar-header">
		      		<a class="navbar-brand" href="#">
		      			<img alt="Brand" src="https://raw.githubusercontent.com/udacity/Sunshine-Version-2/sunshine_master/app/src/main/res/mipmap-xxxhdpi/ic_launcher.png" height="40px" width="40px" style="margin-top: -10px;" />
		      		</a>
			    </div>

    			<!-- Collect the nav links, forms, and other content for toggling -->
    			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      				<ul class="nav navbar-nav">
        				<li class=""><a href="/">Transfers</a></li>
      				</ul>
      				<ul class="nav navbar-nav">
        				<li class="active"><a href="#">Files</a></li>
      				</ul>
    			</div><!-- /.navbar-collapse -->
  			</div><!-- /.container-fluid -->
		</nav>

		<div class="container-fluid">
			<!-- Breadcrumbs -->
			<div id="breadcrumbMaster">
				<ol id="bread" class="breadcrumb">
					<li id="ro_ot" class="active">root</li>
				</ol>
			</div>

			<!-- Files -->
			<div id="masterFileHolder"><ul id="fileHolder" class="list-group"></ul></div>
			
		</div>

		<!-- Main function which controls everything -->
		<script type="text/javascript">
			var socket = io();
			var bid=1;
			var currentPath="/";

			function navigateFolder(folder){
				currentPath+=folder;
				//Update breadcrumbs
				$('#ro_ot').removeClass("active");
				$('#bread').append("<li id='"+bid+"_bread' class=\"active\">"+folder+"</li>");
				bid=bid+1;

				$('#fileHolder').remove();
				$('#masterFileHolder').append("<ul id=\"fileHolder\" class=\"list-group\"></ul>");
				socket.emit('getFiles','/'+folder);
			}

			function downloadFile(file){
				console.log(file);
			}

			function deleteFile(file){
				console.log(file);
			}

			function back(){
				bid=bid-1;
				$('#'+bid+'_bread').remove();
				bid=bid-1;
				$('#'+bid+'_bread').addClass("active");
				$('#fileHolder').remove();
				$('#masterFileHolder').append("<ul id=\"fileHolder\" class=\"list-group\"></ul>");
				//Get current path substring
				currentPath = currentPath.substr(0,currentPath.lastIndexOf("/"));
				console.log(currentPath);
				socket.emit('getFiles',currentPath);
			}

			socket.emit('getFiles','/');

			socket.on('takeFiles', function(msg){
				// console.log(msg);
				var data = JSON.parse(msg);
				//Back
				if(currentPath.length > 2){
					$('#fileHolder').append("<li class=\"list-group-item\"><a onclick=\"back();\">..</a></li>");
				}
				for(var i=0;i<data.length;i++){
					if(data[i].indexOf(".part") > -1){
						// In case of part files, no download option only delete
						$('#fileHolder').append("<li class=\"list-group-item\">"+data[i]+"</li>");
					} else {
						// Download and delete option
						if(data[i].indexOf(".") > -1){
							//This is a file, delete and upload option.
							$('#fileHolder').append("<li class=\"list-group-item\"><a style=\"color:green;\">"+data[i]+"</a> <button type=\"button\" class=\"btn btn-default\" style=\"float:right; margin-top:-5px; height:28px; border:0px;\" onclick=\"deleteFile('"+data[i]+"');\"><span class=\"glyphicon glyphicon-trash\" aria-hidden=\"true\" style=\"color: #F44336;\"></span></button> <button type=\"button\" class=\"btn btn-default\" style=\"float:right; margin-right:10px; margin-top:-5px; border:0px; \" onclick=\"downloadFile('"+data[i]+"');\" ><span class=\"glyphicon glyphicon-download-alt\" aria-hidden=\"true\" style=\"float:right; color: #009688;\"></span></button> </li>");
						} else {
							// This is a folder only delete option
							$('#fileHolder').append("<li class=\"list-group-item\"><a onclick=\"navigateFolder('"+data[i]+"');\">"+data[i]+"</a><button type=\"button\" class=\"btn btn-default\" style=\"float:right; margin-top:-5px; height:28px; border:0px;\" onclick=\"deleteFile('"+data[i]+"');\"><span class=\"glyphicon glyphicon-trash\" aria-hidden=\"true\" style=\"color: #F44336;\"></span></button></li>");
						}
					}
				}
			});

		</script>
	</body>
</html>